<!--
@group: 3
@name: Shared Worspace
@Course Code: SODV1201
@class: Software Development Diploma program.
@author: Erika Ortiz, Emiliano Martinez, Paola Lampe Tinoco, Ashpreet Kaur   
@reference:
-->
 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Your content goes here -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Workspace</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Introduction to Web Programming</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="property.html">Properties</a></li>
            </ul>
        </nav>
    </header>
 
    <div class="container">
        <h2>Book List</h2>
        <ul id="book-list"></ul>
    </div>
 
    <div class="container">
        <h1>Library</h1>
        <form id="add-form">
            <input type="text" id="address" placeholder="Address" required>
            <input type="text" id="neighborhood" placeholder="Neighborhood" required>
            <input type="text" id="parking" placeholder="Parking" required>
            <input type="text" id="transit" placeholder="Transit" required>
            <input type="text" id="workspace" placeholder="Workspace" required>
            <input type="text" id="type" placeholder="Type" required>
            <input type="number" id="price" placeholder="Price" required>
            <input type="text" id="availability" placeholder="Availability" required>
            <input type="date" id="availabilityDate" placeholder="Availability Date" required>
            <input type="text" id="leaseTerm" placeholder="Lease Term" required>
            <input type="number" id="sqft" placeholder="Sqft" required>
            <input type="number" id="seats" placeholder="Seats" required>
            <input type="checkbox" id="smoking"> Smoking Allowed
            <button type="submit">Add Property</button>
        </form>
    
        <a href = "/detailProperty.html">View Books</a>
    
        
      </div>
      <footer>
        <p>&copy; Bow Valley College <span id="current-year"></span></p>
    </footer> 
    
      <script>
        document.getElementById('add-form').onsubmit = async (event) => {
            event.preventDefault();
 
            const newBook = {
                address: document.getElementById('address').value,
                neighborhood: document.getElementById('neighborhood').value,
                parking: document.getElementById('parking').value,
                transit: document.getElementById('transit').value,
                workspace: document.getElementById('workspace').value,
                type: document.getElementById('type').value,
                price: parseFloat(document.getElementById('price').value),  // Convert to number
                availability: document.getElementById('availability').value,
                availabilityDate: document.getElementById('availabilityDate').value,
                leaseTerm: document.getElementById('leaseTerm').value,
                sqft: parseFloat(document.getElementById('sqft').value),  // Convert to number
                seats: parseInt(document.getElementById('seats').value, 10),  // Convert to integer
                smoking: document.getElementById('smoking').checked  // Convert to boolean
            };
 
            try {
                const response = await fetch('/add-book', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newBook)
                });
 
                if (response.ok) {
                    alert('Property added successfully.');
                    window.location.href = '/property.html';  // Redirect after adding
                } else {
                    alert('Failed to add the property.');
                }
            } catch (error) {
                console.error('Error adding property:', error);
                alert('Error adding property.');
            }
        };
 
        async function fetchBooks() {
    const response = await fetch('/books');
    const books = await response.json();
    const bookList = document.getElementById('book-list');
    bookList.innerHTML = '';
    
    books.forEach((book, index) => {
        const listItem = document.createElement('li');
        
        // Crear enlace para ver detalles de la propiedad
        const addressLink = document.createElement('a');
        addressLink.href = `/detalles.html?index=${index}`;  // Redirigir a la página de detalles
        addressLink.textContent = book.address;
        addressLink.style.display = 'block'; // Opcional, para que cada dirección esté en una nueva línea
        
        listItem.appendChild(addressLink);
 
      
        bookList.appendChild(listItem);
        });
    }
    
    document.addEventListener('DOMContentLoaded', fetchBooks);
    document.getElementById('current-year').textContent = new Date().getFullYear();

    </script>
    
    </body>
    </html>