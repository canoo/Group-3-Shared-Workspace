<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Workspace</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            cursor: pointer;
        }
        .rent-button {
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 2px 1px;
            cursor: pointer;
            border-radius: 5px;
        }
        .rent-button:hover {
            background-color: #45a049; /* Darker green */
        }
    </style>
</head>
<body>

    <main>
        
        <header>
            <h1>Shared Workspaces</h1>
            <nav>
                <ul>
                    <li><a href="home.html">Home</a></li>
                    <li><a href="contactus.html">Contact us</a></li>
                    <li><button class="logoutButton" onclick="logout()">Logout</button></li>
                </ul>
            </nav>
        </header>

        <img id="img-1" src="img/img1.jpg" alt="img1"> 

        <h1 class="subTittle">Workspaces</h1>
      
        <div class="topnav">
            <p>Property Search</p>
            <input type="text" id="search" placeholder="Search..">
        </div>

        <div class="container">
            <h2>Property List</h2>
            <table id="property-table">
                <thead>
                    <tr>
                        <th onclick="sortTable(0)">Address</th>
                        <th onclick="sortTable(1)">Price</th>
                        <th onclick="sortTable(2)">Seats</th>
                        <th onclick="sortTable(3)">Availability</th>
                        <th>Actions</th> <!-- New column for actions -->
                    </tr>
                </thead>
                <tbody id="property-list"></tbody>
            </table>
        </div>

        <script>
            async function fetchProperties() {
                try {
                    const response = await fetch('/api/properties');
                    const result = await response.json();
                    
                    console.log('Raw response data:', result); // Verifica la estructura de datos

                    const properties = result.data || []; // Accede a 'data' que contiene el array de propiedades
                    updateTable(properties);
                } catch (error) {
                    console.error('Error fetching properties:', error);
                    alert('Error loading properties.');
                }
            }

            function updateTable(properties) {
                const propertyList = document.getElementById('property-list');
                propertyList.innerHTML = '';

                properties.forEach((property, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${property.address || 'N/A'}</td>
                        <td>${property.price || 'N/A'}</td>
                        <td>${property.seats || 'N/A'}</td>
                        <td>${property.availability || 'N/A'}</td>
                        <td><button class="rent-button" onclick="viewDetails(${index})">Rent</button></td>
                    `;
                    propertyList.appendChild(row);
                });
            }

            function viewDetails(index) {
                window.location.href = `detalles.html?index=${index}`;
            }

            function sortTable(columnIndex) {
                const table = document.getElementById('property-table');
                const rows = Array.from(table.querySelectorAll('tbody tr'));
                const isAscending = table.querySelector(`th:nth-child(${columnIndex + 1})`).classList.toggle('asc');

                rows.sort((rowA, rowB) => {
                    const cellA = rowA.children[columnIndex].textContent.trim();
                    const cellB = rowB.children[columnIndex].textContent.trim();

                    const valueA = isNaN(cellA) ? cellA : parseFloat(cellA);
                    const valueB = isNaN(cellB) ? cellB : parseFloat(cellB);

                    if (valueA < valueB) return isAscending ? -1 : 1;
                    if (valueA > valueB) return isAscending ? 1 : -1;
                    return 0;
                });

                rows.forEach(row => table.querySelector('tbody').appendChild(row));
            }

            function logout() {
                localStorage.removeItem('authToken');
                localStorage.removeItem('userInfo');
                window.location.href = 'index.html';
            }

            document.getElementById('search').addEventListener('input', function() {
                const filter = this.value.toLowerCase();
                const rows = document.querySelectorAll('#property-list tr');

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(filter) ? '' : 'none';
                });
            });

            document.addEventListener('DOMContentLoaded', fetchProperties);
            document.getElementById('current-year').textContent = new Date().getFullYear();
        </script>
    </main>

    <footer>
        <p>&copy; Bow Valley College <span id="current-year"></span></p>
    </footer>

</body>
</html>